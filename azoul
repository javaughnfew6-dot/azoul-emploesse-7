<!-- In your renderHtml() function, return this updated HTML -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Employee Reports – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0b1620;
      --panel: #0f2133;
      --panel2: #0d1b2a;
      --text: #eaf2fb;
      --muted: #93a4b7;
      --warn: #f7b801;
      --danger: #ff6b6b;
      --accent: #4bb6f0;
    }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { display:flex; align-items:center; justify-content:space-between; padding: 16px 20px; background: linear-gradient(180deg, #0d2640, #0b1620); position: sticky; top:0; z-index:10; border-bottom: 1px solid #123; }
    h1 { margin: 0; font-size: 18px; letter-spacing: .4px; }
    .controls { display:flex; flex-wrap: wrap; gap: 8px; align-items: center; }
    button, select, input { background: var(--panel); color: var(--text); border: 1px solid #234; padding: 8px 10px; border-radius: 8px; }
    button:hover { filter: brightness(1.08); }
    .btn-warn { background: #4a3b10; border-color: #6b520f; }
    .btn-danger { background: #5c1d1d; border-color: #7a2a2a; }
    .btn-ok { background: #0f3a2a; border-color: #17563e; }
    .page { padding: 16px 20px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .card {
      position: relative;
      background: var(--panel2);
      border: 1px solid #123;
      border-radius: 10px;
      padding: 12px 56px 12px 12px; /* extra right padding so the X never overlaps text */
      display:flex; gap: 12px; align-items:flex-start;
      overflow: visible; /* make sure absolutely-positioned button shows */
    }
    .deleted { opacity: .6; border-color: #402; background: #1c0f19; }
    .row-top { display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .left { display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .right { display:flex; gap: 8px; align-items:center; }
    .meta { font-size: 12px; color: var(--muted); display:flex; gap:6px; flex-wrap:wrap; margin-top: 6px; }
    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; background: #1b3a57; color: #d6ecff; font-size: 11px; margin-right: 6px; }
    .small { font-size: 12px; }
    .muted { color: var(--muted); }

    /* BIG, visible X delete button */
    .del-x {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: 1px solid #7a2a2a;
      background: #c43d3d; /* bright */
      color: #fff;
      font-weight: 900;
      font-size: 18px;
      line-height: 30px;
      text-align: center;
      cursor: pointer;
      z-index: 5; /* above everything inside the card */
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      user-select: none;
    }
    .del-x:hover { filter: brightness(1.05); }
    .del-x:active { transform: translateY(1px); }
  </style>
</head>
<body>
  <header>
    <h1>Employee Reports – Admin</h1>
    <div class="controls">
      <button id="refreshBtn">Refresh</button>
      <button id="selectAllBtn">Select all</button>
      <button id="clearSelBtn">Clear</button>
      <label class="small"><input type="checkbox" id="showDeleted"> Show deleted</label>
      <a href="/api/export" target="_blank"><button>Export JSON</button></a>
    </div>
  </header>

  <div class="page">
    <div class="controls">
      <button id="delSoftBtn" class="btn-warn">Delete selected (soft)</button>
      <button id="delHardBtn" class="btn-danger">Delete selected (hard)</button>
      <button id="undoBtn" class="btn-ok">Undo last soft delete</button>
    </div>

    <div class="controls" style="margin-top:10px">
      <label class="small"><input type="checkbox" id="fUnknown"> Email is "Unknown" / empty</label>
      <select id="fTags" multiple size="5" title="Hold Ctrl/Cmd to select multiple">
        <!-- You can customize these tags -->
        <option>Other</option><option>Management</option><option>Low Pay</option>
        <option>Career Growth</option><option>Overtime</option><option>Benefits</option>
        <option>Safety</option><option>Culture</option><option>Burnout</option>
        <option>No issue selected</option>
      </select>
      <span class="small">From: <input type="datetime-local" id="fAfter"></span>
      <span class="small">To: <input type="datetime-local" id="fBefore"></span>
      <button id="fSoftBtn" class="btn-warn">Delete by filter (soft)</button>
      <button id="fHardBtn" class="btn-danger">Delete by filter (hard)</button>
    </div>

    <div id="list" class="grid"></div>
  </div>

  <script>
    const $ = (q) => document.querySelector(q);
    const state = { data: [], selected: new Set() };
    const fmtDate = (iso) => iso ? new Date(iso).toLocaleString() : "—";
    const tagsPretty = (tags) => Array.isArray(tags) ? tags.map(t => '<span class="pill">' + t + '</span>').join(" ") : "";

    async function fetchReports() {
      const showDeleted = $("#showDeleted").checked;
      const res = await fetch("/api/reports?includeDeleted=" + showDeleted);
      state.data = await res.json();
      render();
    }

    function render() {
      const list = $("#list");
      list.innerHTML = "";
      state.data.forEach(r => {
        const card = document.createElement("div");
        card.className = "card" + (r.deleted_at ? " deleted" : "");
        card.dataset.id = r.id;

        // Visible “×” button
        const delBtn = document.createElement("button");
        delBtn.className = "del-x";
        delBtn.type = "button";
        delBtn.setAttribute("aria-label", "Delete report");
        delBtn.title = "Click: soft delete. Hold Shift: hard delete.";
        delBtn.textContent = "×";
        delBtn.addEventListener("click", (ev) => handleRowDelete(ev, r.id));
        card.appendChild(delBtn);

        // Optional selection checkbox (for bulk)
        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = state.selected.has(r.id);
        cb.addEventListener("change", () => {
          if (cb.checked) state.selected.add(r.id);
          else state.selected.delete(r.id);
        });

        const content = document.createElement("div");
        content.style.flex = "1";

        const top = document.createElement("div");
        top.className = "row-top";
        const left = document.createElement("div");
        left.className = "left";
        left.innerHTML = \`
          <div><strong>\${r.email || "Unknown"}</strong></div>
          <div class="muted">Issue: \${r.issue || "N/A"}</div>
        \`;

        const right = document.createElement("div");
        right.className = "right small";
        right.innerHTML = \`<span class="muted">\${fmtDate(r.created_at)}</span>\`;

        top.appendChild(left);
        top.appendChild(right);

        const meta = document.createElement("div");
        meta.className = "meta";
        meta.innerHTML = tagsPretty(r.tags);

        content.appendChild(top);
        content.appendChild(meta);

        card.appendChild(cb);
        card.appendChild(content);
        list.appendChild(card);
      });
    }

    async function handleRowDelete(ev, id) {
      const hard = ev.shiftKey; // Shift+Click => hard delete
      if (hard && !confirm("Hard delete this report? This cannot be undone.")) return;
      const res = await fetch("/api/reports/" + encodeURIComponent(id) + "?soft=" + (!hard), { method: "DELETE" });
      const data = await res.json().catch(() => ({}));
      if (!res.ok) return alert("Delete failed: " + (data.error || res.statusText));
      fetchReports();
    }

    // Bulk controls
    const postJSON = async (url, body) => {
      const res = await fetch(url, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body) });
      if (!res.ok) throw new Error((await res.json().catch(()=>({}))).error || (res.status + " " + res.statusText));
      return res.json();
    };
    const getSelectedIds = () => Array.from(state.selected);

    document.addEventListener("DOMContentLoaded", () => {
      $("#refreshBtn").addEventListener("click", fetchReports);
      $("#selectAllBtn").addEventListener("click", () => { state.data.forEach(r => state.selected.add(r.id)); render(); });
      $("#clearSelBtn").addEventListener("click", () => { state.selected.clear(); render(); });
      $("#showDeleted").addEventListener("change", fetchReports);

      $("#delSoftBtn").addEventListener("click", async () => {
        const ids = getSelectedIds(); if (!ids.length) return alert("No rows selected.");
        const { deleted } = await postJSON("/api/reports/bulk-delete", { ids, softDelete: true });
        alert("Soft-deleted " + deleted + " report(s).");
        state.selected.clear(); fetchReports();
      });

      $("#delHardBtn").addEventListener("click", async () => {
        const ids = getSelectedIds(); if (!ids.length) return alert("No rows selected.");
        if (!confirm("Hard delete " + ids.length + " report(s)? This cannot be undone.")) return;
        const { deleted } = await postJSON("/api/reports/bulk-delete", { ids, softDelete: false });
        alert("Hard-deleted " + deleted + " report(s).");
        state.selected.clear(); fetchReports();
      });

      $("#fSoftBtn").addEventListener("click", async () => {
        const tagIn = Array.from($("#fTags").options).filter(o => o.selected).map(o => o.value);
        const after = $("#fAfter").value ? new Date($("#fAfter").value).toISOString() : null;
        const before = $("#fBefore").value ? new Date($("#fBefore").value).toISOString() : null;
        const res = await postJSON("/api/reports/delete-by-filter", {
          emailIsUnknown: $("#fUnknown").checked, tagIn, createdAfter: after, createdBefore: before, softDelete: true
        });
        alert(\`Soft-deleted \${res.deleted} (would affect: \${res.wouldAffect})\`);
        fetchReports();
      });

      $("#fHardBtn").addEventListener("click", async () => {
        if (!confirm("Hard delete by filter? This cannot be undone.")) return;
        const tagIn = Array.from($("#fTags").options).filter(o => o.selected).map(o => o.value);
        const after = $("#fAfter").value ? new Date($("#fAfter").value).toISOString() : null;
        const before = $("#fBefore").value ? new Date($("#fBefore").value).toISOString() : null;
        const res = await postJSON("/api/reports/delete-by-filter", {
          emailIsUnknown: $("#fUnknown").checked, tagIn, createdAfter: after, createdBefore: before, softDelete: false
        });
        alert(\`Hard-deleted \${res.deleted} (would affect: \${res.wouldAffect})\`);
        fetchReports();
      });

      $("#undoBtn").addEventListener("click", async () => {
        const res = await postJSON("/api/reports/undo", {});
        alert("Restored " + res.restored + " report(s).");
        fetchReports();
      });

      fetchReports();
    });
  </script>
</body>
</html>
