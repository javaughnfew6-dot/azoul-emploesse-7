<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Azoul ¬∑ Manager Dashboard</title>

<style>
/* ====== THEME ====== */
:root{
  --bg:#0d162b;
  --bg-soft:#0b162a;
  --panel:#101f39;
  --brand:#2363ff;
  --ring: rgba(35,99,255,.35);
  --card-shadow:0 8px 20px rgba(0,0,0,.25);
  --radius:14px;
}

/* ====== RESET ====== */
*{ box-sizing:border-box; }
html,body{ height:100%; margin:0; font-family:system-ui,Segoe UI,Roboto; }
body{
  background:linear-gradient(180deg,#0a1530,var(--bg) 28%,#0a1530 100%);
  color:#e6eefb;
}

/* ====== LAYOUT ====== */
.wrap{ max-width:1040px; margin:auto; padding:20px; }
header{ display:flex; align-items:center; gap:.6rem; margin-bottom:16px; }
header .dot{
  width:10px;height:10px;border-radius:50%;
  background:conic-gradient(#4da3ff,#c6dcff,#7fb5ff,#4da3ff);
  box-shadow:0 0 16px rgba(77,163,255,.6);
}
header .brand{ font-weight:800; font-size:20px }

/* ====== PANELS ====== */
.panel{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px; padding:16px;
  backdrop-filter:blur(6px);
}
.panel-inner{
  background:var(--panel);
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  padding:20px;
}

/* ====== INPUTS ====== */
label{ font-size:13px; color:#dbeafe; margin:6px 0; display:block; }
.input, select{
  width:100%;
  background:var(--bg-soft);
  border:1.5px solid rgba(255,255,255,.12);
  color:#e6edf7; border-radius:10px;
  padding:12px; outline:none;
}
.input:focus, select:focus{
  border-color:var(--brand);
  box-shadow:0 0 0 4px var(--ring);
}

/* ====== BUTTONS ====== */
.btn{
  appearance:none; border:none; cursor:pointer;
  background:var(--brand); color:white; font-weight:800;
  padding:12px 16px;
  border-radius:10px;
  box-shadow:0 10px 18px rgba(35,99,255,.28);
  transition:.2s ease;
}
.btn:hover{ filter:brightness(1.08); }
.btn:active{ transform:translateY(1px); }
.btn:disabled{ opacity:.6; cursor:not-allowed; }

/* Reset button */
.btn-reset{
  background:transparent;
  color:#e6eefb;
  border:1px solid rgba(255,255,255,.25);
  font-weight:700;
}
.btn-reset:hover{
  background:rgba(255,255,255,.06);
}

/* ====== GRID ====== */
.row{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
@media (max-width:760px){ .row{ grid-template-columns:1fr } }

/* ====== LIST & CARDS ====== */
.list{ display:grid; gap:12px; }

.card{
  background:white; color:#0f172a;
  border:1px solid #e6eaf2;
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--card-shadow);
  position:relative;
  overflow:visible;
  animation:fadeIn .25s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(4px);}
  to{opacity:1;transform:none;}
}

/* ====== BADGES ====== */
.badges{ display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 }
.badge{
  padding:6px 10px;
  font-size:12px; font-weight:700;
  border-radius:999px;
  display:inline-flex; gap:6px;
  border:1px solid;
}

.b-red{ background:#fee2e2; color:#7f1d1d; border-color:#fecaca }
.b-orange{ background:#ffedd5; color:#7c2d12; border-color:#fed7aa }
.b-amber{ background:#fef3c7; color:#78350f; border-color:#fde68a }
.b-indigo{ background:#e0e7ff; color:#1e1b4b; border-color:#c7d2fe }
.b-purple{ background:#f3e8ff; color:#581c87; border-color:#e9d5ff }
.b-teal{ background:#ccfbf1; color:#134e4a; border-color:#99f6e4 }
.b-blue{ background:#dbeafe; color:#1e3a8a; border-color:#bfdbfe }
.b-slate{ background:#e2e8f0; color:#0f172a; border-color:#cbd5e1 }

.muted{ color:#475569; }

/* ===== DELETE BUTTON ===== */
.del-x{
  position:absolute;
  top:10px; right:10px;
  width:32px; height:32px;
  border-radius:8px;
  background:#c43d3d;
  border:1px solid #7a2a2a;
  color:white;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  transition:.15s ease;
}
.del-x:hover{ filter:brightness(1.1); }
.del-x:active{ transform:translateY(1px); }
</style>
</head>
<body>

<div class="wrap">

  <header>
    <span class="dot"></span>
    <div class="brand">Azoul <small style="opacity:.75;font-weight:700;margin-left:.35rem">Manager</small></div>
  </header>

  <!-- LOGIN -->
  <section class="panel" id="loginPanel">
    <div class="panel-inner">
      <h1>Manager Login</h1>

      <div class="row">
        <div>
          <label>Manager Email</label>
          <input id="mEmail" class="input" type="email" placeholder="manager@example.com">
        </div>
        <div>
          <label>Manager Access Code</label>
          <input id="mCode" class="input" type="password" placeholder="Enter access code">
        </div>
      </div>

      <div style="margin-top:12px; display:flex; justify-content:flex-end;">
        <button id="loginBtn" class="btn">View Reports</button>
      </div>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section class="panel" id="dashPanel" style="margin-top:14px;display:none;">
    <div class="panel-inner">

      <div class="topbar" style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <h1 style="margin:0;">Employee Reports</h1>
          <div id="countText" class="muted">0 results</div>
        </div>
        <span class="pill" id="mWho">‚Äî</span>
      </div>

      <div class="filters" style="display:flex;gap:10px;flex-wrap:wrap;">
        <select id="teamFilter">
          <option value="all">All Teams</option>
        </select>

        <select id="issueFilter">
          <option value="all">All Issues</option>
          <option value="harassment">Harassment</option>
          <option value="safety">Safety</option>
          <option value="burnout">Burnout</option>
          <option value="overtime">Overtime</option>
          <option value="low-pay">Low Pay</option>
          <option value="management">Management</option>
          <option value="career">Career Growth</option>
          <option value="benefits">Benefits</option>
          <option value="culture">Culture</option>
        </select>

        <button id="resetBtn" class="btn btn-reset">Reset</button>
      </div>

      <div class="list" id="reportList"></div>

    </div>
  </section>

</div>

<script>
// ===== CONFIG =====
const MANAGER_CODE = "azoul-admin-2025";

// ===== COLORS =====
const issueColors = {
  "harassment": "b-red",
  "safety": "b-red",
  "burnout": "b-orange",
  "overtime": "b-amber",
  "low-pay": "b-indigo",
  "management": "b-purple",
  "career": "b-teal",
  "benefits": "b-blue",
  "culture": "b-slate",
};

// ===== DOM =====
const loginPanel = document.getElementById("loginPanel");
const dashPanel  = document.getElementById("dashPanel");
const loginBtn   = document.getElementById("loginBtn");
const mEmail     = document.getElementById("mEmail");
const mCode      = document.getElementById("mCode");
const mWho       = document.getElementById("mWho");

const teamFilter = document.getElementById("teamFilter");
const issueFilter= document.getElementById("issueFilter");
const resetBtn   = document.getElementById("resetBtn");
const reportList = document.getElementById("reportList");
const countText  = document.getElementById("countText");

// ===== HELPERS =====
function getReports(){
  try { return JSON.parse(localStorage.getItem("azoul_reports") || "[]"); }
  catch { return []; }
}

function renderBadge(key){
  const cls = issueColors[key] || "b-slate";
  const pretty = ({
    "low-pay":"Low Pay",
    "harassment":"Harassment",
    "burnout":"Burnout",
    "overtime":"Overtime",
    "safety":"Safety",
    "management":"Management",
    "career":"Career Growth",
    "benefits":"Benefits",
    "culture":"Culture"
  })[key] || key;

  return `<span class="badge ${cls}">${pretty}</span>`;
}

function uniqueTeams(arr){
  return [...new Set(arr.map(r => r?.user?.team || "N/A"))].sort();
}

/* ===== Delete handler ===== */
async function handleRowDelete(ev, id){
  const hard = ev.shiftKey;
  if(hard && !confirm("Hard delete this report? This cannot be undone.")) return;

  // LocalStorage delete (soft = hide, hard = remove)
  const all = getReports();
  const filtered = all.filter(r => r.id !== id);
  localStorage.setItem("azoul_reports", JSON.stringify(filtered));

  fetchReports(); // refresh list
}

/* ===== RENDERING ===== */
function renderList(data){
  reportList.innerHTML = data.map(r => {
    const email = r?.user?.email || "Unknown";
    const team  = r?.user?.team  || "N/A";
    const when  = r?.savedAt ? new Date(r.savedAt).toLocaleString() : "‚Äî";
    const badges = (r?.selections || []).map(renderBadge).join(" ");
    const other  = r?.other || "‚Äî";

    return `
      <div class="card" data-id="${r.id}">
        <button class="del-x" title="Click = soft delete, Shift+Click = hard delete">üóëÔ∏è</button>

        <div style="display:flex;justify-content:space-between;flex-wrap:wrap;">
          <div><strong>${email}</strong> ¬∑ <span class="muted">${team}</span></div>
          <div class="muted">${when}</div>
        </div>

        <div class="badges">${badges || `<span class="badge b-slate">No issue selected</span>`}</div>

        <div><span class="muted">Other:</span> ${other}</div>
      </div>
    `;
  }).join("");

  countText.textContent = `${data.length} result${data.length===1?"":"s"}`;

  // attach delete handlers
  document.querySelectorAll(".card .del-x").forEach(btn=>{
    btn.addEventListener("click", ev=>{
      const card = ev.target.closest(".card");
      handleRowDelete(ev, card.dataset.id);
    });
  });
}

function applyFilters(all){
  const t = teamFilter.value;
  const i = issueFilter.value;
  return all.filter(r=>{
    const teamOK  = (t==="all" || (r?.user?.team || "N/A") === t);
    const issueOK = (i==="all" || (r?.selections || []).includes(i));
    return teamOK && issueOK;
  });
}

function fetchReports(){
  const all = getReports();
  renderList(applyFilters(all));
}

/* ===== LOGIN FLOW ===== */
loginBtn.addEventListener("click", ()=>{
  const email = mEmail.value.trim();
  const code  = mCode.value.trim();

  if(!email || !code) return alert("Fill all fields");
  if(code !== MANAGER_CODE) return alert("Wrong manager code");

  loginPanel.style.display = "none";
  dashPanel.style.display  = "block";
  mWho.textContent = email;

  const all = getReports();
  const teams = uniqueTeams(all);

  teamFilter.innerHTML = `<option value="all">All Teams</option>` +
    teams.map(t=>`<option>${t}</option>`).join("");

  fetchReports();

  teamFilter.onchange = fetchReports;
  issueFilter.onchange = fetchReports;
  resetBtn.onclick = ()=>{
    teamFilter.value="all";
    issueFilter.value="all";
    fetchReports();
  };
});

</script>
</body>
</html>
