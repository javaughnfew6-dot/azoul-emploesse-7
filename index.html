<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Azoul · Manager Dashboard</title>
<style>
  :root{
    --bg:#0d162b;
    --panel:#101f39;
    --brand:#2363ff;
    --ring: rgba(35,99,255,.35);
  }
  *{ box-sizing: border-box }
  html,body{ height:100% }
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",Arial,sans-serif;
    background: linear-gradient(180deg,#0a1530, var(--bg) 28%, #0a1530 100%);
    color:#e6eefb;
  }
  .wrap{ max-width:1040px; margin:auto; padding:20px }
  header{ display:flex; align-items:center; gap:.6rem; margin-bottom:16px }
  header .dot{ width:10px;height:10px;border-radius:50%; background:conic-gradient(#4da3ff,#c6dcff,#7fb5ff,#4da3ff); box-shadow:0 0 16px rgba(77,163,255,.6) }
  header .brand{ font-weight:800 }
  .panel{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.08);
    border-radius:16px; padding:16px; backdrop-filter: blur(6px);
  }
  .panel-inner{
    background:var(--panel); border:1px solid rgba(255,255,255,.08);
    border-radius:12px; padding:18px;
  }
  h1{ font-size:24px; margin: 0 0 10px }
  label{ font-size:13px; color:#dbeafe; margin:4px 0 6px; display:block }
  .input{
    width:100%; background:#0b162a; border:1.5px solid rgba(255,255,255,.12); color:#e6edf7;
    border-radius:10px; padding:12px; outline:none;
  }
  .input:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring) }
  .btn{
    appearance:none; border:none; cursor:pointer; background:var(--brand); color:white; font-weight:800;
    padding:12px 16px; border-radius:10px; box-shadow:0 10px 18px rgba(35,99,255,.28);
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed }

  .row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px }
  @media (max-width:760px){ .row{ grid-template-columns:1fr } }

  .filters{ display:flex; flex-wrap:wrap; gap:10px; margin: 8px 0 16px }
  select{
    background:#0b162a; color:#e6edf7; border:1.5px solid rgba(255,255,255,.12);
    border-radius:10px; padding:10px 12px; outline:none;
  }
  select:focus{ border-color:var(--brand); box-shadow:0 0 0 4px var(--ring) }

  .card{
    background:#ffffff; color:#0f172a; border:1px solid #e6eaf2; border-radius:14px; padding:14px;
    box-shadow:0 6px 16px rgba(8,15,30,.1);
  }
  .list{ display:grid; gap:12px }

  .badges{ display:flex; flex-wrap:wrap; gap:8px; margin:6px 0 }
  .badge{
    display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
    font-weight:700; font-size:12px; border:1px solid;
  }
  /* Color tokens */
  .b-red{ background:#fee2e2; color:#7f1d1d; border-color:#fecaca }
  .b-orange{ background:#ffedd5; color:#7c2d12; border-color:#fed7aa }
  .b-amber{ background:#fef3c7; color:#78350f; border-color:#fde68a }
  .b-indigo{ background:#e0e7ff; color:#1e1b4b; border-color:#c7d2fe }
  .b-purple{ background:#f3e8ff; color:#581c87; border-color:#e9d5ff }
  .b-teal{ background:#ccfbf1; color:#134e4a; border-color:#99f6e4 }
  .b-blue{ background:#dbeafe; color:#1e3a8a; border-color:#bfdbfe }
  .b-slate{ background:#e2e8f0; color:#0f172a; border-color:#cbd5e1 }

  .muted{ color:#334155 }
  .topbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px }
  .pill{ background:#eef2ff; border:1px solid #c7d2fe; color:#1f2a5c; border-radius:999px; padding:8px 12px; font-weight:800 }
  .right{ display:flex; gap:8px; align-items:center; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <span class="dot" aria-hidden="true"></span>
      <div class="brand">Azoul <small style="opacity:.75;font-weight:700;margin-left:.35rem">Manager</small></div>
    </header>

    <!-- Login -->
    <section class="panel" id="loginPanel">
      <div class="panel-inner">
        <h1>Manager Login</h1>
        <div class="row">
          <div>
            <label for="mEmail">Manager Email</label>
            <input id="mEmail" class="input" type="email" placeholder="manager@example.com" />
          </div>
          <div>
            <label for="mCode">Manager Access Code</label>
            <input id="mCode" class="input" type="password" placeholder="Enter access code" />
          </div>
        </div>
        <div style="margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:flex-end">
          <button id="loginBtn" class="btn">View Reports</button>
        </div>
      </div>
    </section>

    <!-- Dashboard -->
    <section class="panel" id="dashPanel" style="margin-top:14px; display:none">
      <div class="panel-inner">
        <div class="topbar">
          <div>
            <h1 style="margin:0">Employee Reports</h1>
            <div class="muted" id="countText">0 results</div>
          </div>
          <div class="right">
            <span class="pill" id="mWho">—</span>
          </div>
        </div>

        <div class="filters">
          <select id="teamFilter">
            <option value="all">All Teams</option>
          </select>
          <select id="issueFilter">
            <option value="all">All Issues</option>
            <option value="harassment">Harassment</option>
            <option value="safety">Safety</option>
            <option value="burnout">Burnout</option>
            <option value="overtime">Overtime</option>
            <option value="low-pay">Low Pay</option>
            <option value="management">Management</option>
            <option value="career">Career Growth</option>
            <option value="benefits">Benefits</option>
            <option value="culture">Culture</option>
          </select>
          <button class="btn" id="resetBtn" style="background:transparent;color:#e6eefb;border:1px solid rgba(255,255,255,.2)">Reset</button>
        </div>

        <div class="list" id="reportList"></div>
      </div>
    </section>
  </div>

<script>
  // ====== CONFIG ======
  const MANAGER_CODE = "azoul-admin-2025"; // change for production

  // ====== COLOR MAP ======
  const issueColors = {
    "harassment": "b-red",
    "safety": "b-red",
    "burnout": "b-orange",
    "overtime": "b-amber",
    "low-pay": "b-indigo",
    "management": "b-purple",
    "career": "b-teal",
    "benefits": "b-blue",
    "culture": "b-slate",
  };

  // ====== DOM ======
  const loginPanel = document.getElementById('loginPanel');
  const dashPanel  = document.getElementById('dashPanel');
  const mEmail     = document.getElementById('mEmail');
  const mCode      = document.getElementById('mCode');
  const mWho       = document.getElementById('mWho');
  const loginBtn   = document.getElementById('loginBtn');

  const teamFilter = document.getElementById('teamFilter');
  const issueFilter= document.getElementById('issueFilter');
  const resetBtn   = document.getElementById('resetBtn');
  const reportList = document.getElementById('reportList');
  const countText  = document.getElementById('countText');

  // ====== Helpers ======
  const getReports = () => JSON.parse(localStorage.getItem('azoul_reports') || '[]');

  const renderBadge = (key) => {
    const cls = issueColors[key] || 'b-slate';
    const pretty = ({
      "low-pay":"Low Pay",
      "harassment":"Harassment",
      "burnout":"Burnout",
      "overtime":"Overtime",
      "safety":"Safety",
      "management":"Management",
      "career":"Career Growth",
      "benefits":"Benefits",
      "culture":"Culture"
    })[key] || key;
    return `<span class="badge ${cls}">${pretty}</span>`;
  };

  const uniqueTeams = (arr) => [...new Set(arr.map(r => (r?.user?.team || 'N/A')))].sort((a,b)=>a.localeCompare(b));

  const applyFilters = (data) => {
    const t = teamFilter.value;
    const i = issueFilter.value;
    return data.filter(r => {
      const teamOK = (t === 'all' || (r?.user?.team || 'N/A') === t);
      const issueOK = (i === 'all' || (r?.selections || []).includes(i));
      return teamOK && issueOK;
    });
  };

  const renderList = (data) => {
    const items = data.map(r => {
      const email = r?.user?.email || 'Unknown';
      const team = r?.user?.team || 'N/A';
      const when = r?.savedAt ? new Date(r.savedAt).toLocaleString() : '—';
      const badges = (r?.selections || []).map(renderBadge).join(' ');
      const other = r?.other || '—';

      return `
        <div class="card">
          <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap">
            <div><strong>${email}</strong> · <span class="muted">${team}</span></div>
            <div class="muted">${when}</div>
          </div>
          <div class="badges">${badges || '<span class="badge b-slate">No issue selected</span>'}</div>
          <div><span class="muted">Other:</span> ${other}</div>
        </div>
      `;
    }).join('');
    reportList.innerHTML = items || `<div class="card">No reports yet.</div>`;
    countText.textContent = `${data.length} result${data.length===1?'':'s'}`;
  };

  // ====== Login flow ======
  loginBtn.addEventListener('click', () => {
    const email = mEmail.value.trim();
    const code  = mCode.value.trim();
    if(!email || !code){ alert('Fill all fields'); return; }
    if(code !== MANAGER_CODE){ alert('Wrong manager code'); return; }

    // show dashboard
    loginPanel.style.display = 'none';
    dashPanel.style.display  = 'block';
    mWho.textContent = email;

    // load data
    const all = getReports();

    // populate team filter
    const teams = uniqueTeams(all);
    teamFilter.innerHTML = `<option value="all">All Teams</option>` + teams.map(t => `<option value="${t}">${t}</option>`).join('');

    // render initial
    renderList(all);

    // wiring
    const refresh = () => renderList(applyFilters(all));
    teamFilter.addEventListener('change', refresh);
    issueFilter.addEventListener('change', refresh);
    resetBtn.addEventListener('click', () => {
      teamFilter.value = 'all';
      issueFilter.value = 'all';
      refresh();
    });
  });

  // ====== Guard: if no file found (prevent "code at top" leftovers) ======
  window.addEventListener('DOMContentLoaded', ()=>{
    ['#debug','#dump','.raw','.codesat','pre.dump','pre.raw'].forEach(sel =>
      document.querySelectorAll(sel).forEach(n => n.remove())
    );
  });
</script>
</body>
</html>
